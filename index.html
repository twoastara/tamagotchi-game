<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carinito Sleepy Story</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-blue-100 flex items-center justify-center min-h-screen">
  <div id="game-container" class="relative flex flex-col items-center p-3">
    <div id="note-display" class="bg-white p-3 rounded-lg shadow-lg text-center text-blue-800 font-mono text-sm max-w-xs hidden mb-2"></div>
    <div id="sketch-holder"></div>
  </div>

  <script>
    // Story notes (fixed comma at the end!)
    let noteTexts = [
      "Obligatory to read before sleepy sleep time! 🧸",
      "Anty jet-lag carinito session begins...🫧⋆｡˚",
      "We start as usual...",
      "Take a deeeeeep breath...",
      "Good...",
      "Now once more...",
      "Good girl... ﾒ૦ﾒ૦💋",
      "And one last time...",
      "Well done, my little carinito.",
      "I pull you close, wrapping your little body in my arms.🌷",
      "You’re so small, so perfect 💗",
      "I kiss the top of your head, soft and warm.",
      "‘My brave carinito,’ I whisper, ‘you conquered Japan!’🌊⋆🐚",
      "You deserve the best treatment, my baby. ✿",
      "My hands stroke your back, slow and gentle.🫧🌷",
      "Your eyes start to flutter, getting sleepy...",
      "Very… very… sleepy now. ˖°𓇼🫧",
      "I murmur, ‘Who is my little brave girl?’ִֶָ🦋",
      "You drift off, and say: ‘mimimi’𐀪❤️𐀪",
      "I cuddle you even more and say: ‘Goodnight, my love. Sweet dreams, my baby 𝄞’"
    ];

    // Generate random non-overlapping positions (no p5 dependency)
    function generatePositions(num, canvasSize, minDist, radius) {
      let positions = [];
      for (let i = 0; i < num; i++) {
        let attempts = 0;
        let maxAttempts = 100;
        let pos;
        do {
          pos = {
            x: radius + Math.random() * (canvasSize - 2 * radius),
            y: radius + Math.random() * (canvasSize - 2 * radius)
          };
          attempts++;
        } while (positions.some(p => Math.hypot(pos.x - p.x, pos.y - p.y) < minDist) && attempts < maxAttempts);
        if (attempts < maxAttempts) positions.push(pos);
      }
      return positions;
    }

    // Canvas size adapts a bit for mobile
    const CANVAS = Math.min(360, Math.max(300, Math.floor(window.innerWidth * 0.9)));

    // Create notes with random positions
    let positions = generatePositions(noteTexts.length, CANVAS, 50, 20);
    let notes = noteTexts.map((text, i) => ({
      id: i + 1,
      x: positions[i] ? positions[i].x : 50 + (i % 5) * 60,
      y: positions[i] ? positions[i].y : 50 + Math.floor(i / 5) * 60,
      text: text
    }));

    let currentNote = 1;
    let gameWon = false;

    function setup() {
      let canvas = createCanvas(CANVAS, CANVAS);
      canvas.parent('sketch-holder');
      textAlign(CENTER, CENTER);
      textSize(16);
      textStyle(BOLD);
      noStroke();
    }

    function draw() {
      background(135, 206, 235); // Soft blue background

      if (gameWon) {
        fill(255);
        textSize(18);
        text("Snuggle and sleep well, my carinito~", width / 2, height / 2);
        return;
      }

      notes.forEach(note => {
        if (note.id < currentNote) return; // Skip collected notes

        // Highlight current note
        fill(note.id === currentNote ? 65 : 200, note.id === currentNote ? 105 : 200, note.id === currentNote ? 225 : 200);
        ellipse(note.x, note.y, 44, 44);

        // Number on circle
        fill(255);
        text(note.id, note.x + 1, note.y + 1);
        fill(0);
        text(note.id, note.x, note.y);
      });
    }

    function handlePress(px, py) {
      if (gameWon) return;
      for (let note of notes) {
        if (note.id === currentNote && Math.hypot(px - note.x, py - note.y) < 22) {
          const display = document.getElementById('note-display');
          display.classList.remove('hidden');
          display.innerText = note.text;
          currentNote++;
          if (currentNote > notes.length) gameWon = true;
          break;
        }
      }
    }

    // Mouse & touch support
    function mousePressed() {
      handlePress(mouseX, mouseY);
    }
    function touchStarted() {
      handlePress(mouseX, mouseY);
      return false; // prevent default scrolling on touch
    }
  </script>
</body>
</html>
